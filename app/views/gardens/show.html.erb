<section class="page-view">

  <%= render partial: "garden_info", locals: {garden: @garden} %>

  <ul class="lists list-sortable left">

    <%= render partial: "lists/list", collection: @garden.lists.sort_by { |a| a.list_pos } %>

  </ul>

  <div class="left new-list-button-div"><%= button_to "Add a List!", new_garden_list_url(@garden), method: :get, class: "button new-list-button" %></div>

</section>



<script>

$(document).ready(function(){

  // $( 'a' ).on( 'click', function( event ) {
//     // Prevent the default action.
//     event.preventDefault();
//     // Log stuff.
//     console.log( 'I was just clicked!' );
//   });

  // $( "section" ).on("mouseover", function( event ) {
  //   $( this ).css( "color", "red" );
  // });

  $( ".new-list-button").on("click", function( event ) {
    event.preventDefault();
    $( this ).css( "color", "blue");
    $( ".list-sortable" ).append(  "<%= render partial: 'lists/list', locals: { list: List.new } %>");
  });




  ////////////////LIST & NOTE DRAGGING

  $( ".ui-state-default" ).mouseover().css( "cursor", "pointer" );

  $(function() {
    $( ".list-sortable").sortable({
      stop: function(e, ui) {
        var $lists = $(ui.item.closest("ul").children("li"));

        $lists.each( function(i, elem) {
          var list_wrapper = $(this).find("section.listwrapper")
          var list_id = $(list_wrapper).attr("id")

          var data = {
            list: {
              list_pos: parseInt($(this).index())
            }
          }

          $.ajax({
            url: "/lists/" + list_id,
            type: "PUT",
            data: data,
            dataType:"json",
            success: function(data){
              console.log("sent it out!");
              console.log(data);
            },
            error: console.log("This A shit don't work!")
          });
        });
      }
    }).disableSelection();
    $( ".sortable" ).sortable({
      connectWith: ".sortable",

      stop: function(e, ui) {
        // MOVED ELEMENT AND ITS NEW LIST
        var that = this;

        var NoteId = ui.item.attr("id");
        var NoteIndex = ui.item.index();
        var NoteNewList = ui.item.closest("ul");
        var NoteNewListId = ui.item.closest("ul").parent().attr("id");

        var newListItems = $(NoteNewList.children("li"));

        /////NEW STUFF/////

        newListItems.each( function(i, elem) {
          var note_id = $(this).attr("id");
          console.log(note_id);
          var data = {
            note: {
              list_id: parseInt(NoteNewListId),
              note_pos: parseInt($(this).index())
            }
          };

          $.ajax({
              url: "/notes/" + note_id,
              type: "PUT",
              data: data,
              dataType:"json",
              success: function(data){
                console.log("sent it out!");
                console.log(data);
              },
              error: console.log("This A shit don't work!")
            });

        });

        /////OLD STUFF/////

        var oldListItems = $(that).children("li");
        var note_id = $(this).attr("id");

        oldListItems.each( function(i, elem) {
          var data = {
            note: {
              list_id: parseInt($(that).attr("id")),
              note_pos: parseInt($(this).index())
            }
          };

          $.ajax({
              url: "/notes/" + note_id,
              type: "PUT",
              data: data,
              dataType:"json",
              success: function(data){
                console.log("sent it out!");
                console.log(data);
              },
              error: console.log("This B shit don't work!")
            });

        });
      },

    }).disableSelection();

  });



});

</script>